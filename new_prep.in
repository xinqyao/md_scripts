#!/bin/sh
# Use this script with cautions:
# - Only run the last command if you are confident that your system will be ready to minimize and equilibrate after this script runs. 
# - Attach an # sign in front of the last command if not confident enough. 
# - Set varibles (e.g. 'pdb') in this file to the file that you are actually using. NOTE: these files must be in the folder where this script resides. 
# - This script will create a prep, equil, and production folder to help you know where everything is. 
# - the 'tleap.in' file need to be tailored for the system

mkdir prep
mkdir equil
mkdir production

pdb='prot'
lig='ligand'
wat='wat'
sys='wt'
cd prep/

cp ../$pdb.pdb .
cp ../$lig.pdb .
cp ../$wat.pdb .
#cp ../frcmod.ff99SB_w_dih .   # uncomment if simulating cis-trans isomerization
#cp ../leaprc.phosaa10.ff14sb .
#cp ../frcmod.phosaa10.ff14sb .
#cp ../phos_amino94_ff14sb.lib .   # uncomment above three if simulating phosphorylated residues with ff14sb

cat >tleap.in << EOF
source leaprc.protein.ff14SB
#source leaprc.gaff2            # uncomment if simulating small molecules with force field generated by Antechamber
#source leaprc.phosaa10.ff14sb # uncomment if simulating phophorylated residues with ff14sb
#source leaprc.GLYCAM_06j-1    # uncomment if simulating sugars
source leaprc.water.tip3p
#addAtomTypes{{"O3" "O" "sp2"}} # uncomment if simulating nucleotide
#loadamberparams frcmod.ff99SB_w_dih #uncomment if simulating cis-trans isomerizatino
set default PBradii mbondi2
m1 = loadpdb $pdb.pdb
# bond m1.XXX.SG m1.YYY.SG  # uncomment if having disulfide bonds; XXX and YYY are corresponding cysteins. Add more lines if more than one disulfide bonds. Remember, the affected cysteins must be named 'CYX' in the PDB file.
m2 = loadpdb $lig.pdb
m3 = loadpdb $wat.pdb

## for analysis purpose
sysnowat = combine { m1 m2 }
savepdb sysnowat ${sys}_lig_nowat.pdb
saveamberparm sysnowat ${sys}_lig_nowat.prmtop ${sys}_lig_nowat.inpcrd

sys = combine { m1 m2 m3 }
solvateoct sys TIP3PBOX 10.0 iso
addions sys Na+ 0
addions sys Cl- 0
savepdb sys ${sys}_lig_box.pdb
saveamberparm sys ${sys}_lig_box.prmtop ${sys}_lig_box.inpcrd

## for apo simulations
aponowat = m1
savepdb aponowat ${sys}_apo_nowat.pdb
saveamberparm aponowat ${sys}_apo_nowat.prmtop ${sys}_apo_nowat.inpcrd

apo = combine { m1 m3 }
solvateoct apo TIP3PBOX 10.0 iso
addions apo Na+ 0
addions apo Cl- 0
savepdb apo ${sys}_apo_box.pdb
saveamberparm sys ${sys}_apo_box.prmtop ${sys}_apo_box.inpcrd

quit
EOF

tleap -f tleap.in &>log

#./new_equil.in >& err.log 
